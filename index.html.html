<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Firebase íƒ€ì´ë¨¸ ìˆœìœ„ ì•±</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 50px; }
    input, button { padding: 10px; margin: 5px; }
    #app, #leaderboard { display: none; }
    table { margin: auto; border-collapse: collapse; }
    td, th { border: 1px solid #aaa; padding: 8px; }
  </style>

  <!-- âœ… Firebase SDK (compat ë²„ì „) -->
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-database-compat.js"></script>
  <script>
    // âœ… Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyDMOH8a_y2gCAmXvOCrVL2bRVAFolFNCAc",
      authDomain: "timerapp2-af9ec.firebaseapp.com",
      projectId: "timerapp2-af9ec",
      storageBucket: "timerapp2-af9ec.appspot.com",
      messagingSenderId: "716457355448",
      appId: "1:716457355448:web:49e4c9d0beb2285bda2c4d",
      databaseURL: "https://timerapp2-af9ec-default-rtdb.firebaseio.com"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
</head>
<body>
  <h1>â±ï¸ Firebase íƒ€ì´ë¨¸ ìˆœìœ„ ì•±</h1>

  <!-- ë¡œê·¸ì¸ -->
  <div id="login">
    <input type="text" id="username" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" />
    <button onclick="login()">ë¡œê·¸ì¸</button>
  </div>

  <!-- ë©”ì¸ ì•± -->
  <div id="app">
    <h2>í™˜ì˜í•©ë‹ˆë‹¤, <span id="userDisplay"></span>ë‹˜!</h2>
    <h3>íƒ€ì´ë¨¸: <span id="timer">0.00</span>ì´ˆ</h3>
    <button onclick="startTimer()">â–¶ï¸ ì‹œì‘</button>
    <button onclick="togglePause()">â¸ï¸ ì¼ì‹œì •ì§€ / â–¶ï¸ ì¬ê°œ</button>
    <button onclick="saveRecord()">ğŸ’¾ ê¸°ë¡ ì €ì¥</button>
    <br><br>
    <button onclick="showLeaderboard()">ğŸ“Š ìˆœìœ„ ë³´ê¸°</button>
    <button onclick="changeNickname()">âœï¸ ë‹‰ë„¤ì„ ë³€ê²½</button>
  </div>

  <!-- ìˆœìœ„í‘œ -->
  <div id="leaderboard">
    <h2>ğŸ† ìˆœìœ„í‘œ (ê¸´ ì‹œê°„ ìˆœ)</h2>
    <table id="rankingTable">
      <tr><th>ìˆœìœ„</th><th>ë‹‰ë„¤ì„</th><th>ê¸°ë¡ (ì´ˆ)</th></tr>
    </table>
    <button onclick="goBack()">â¬… ëŒì•„ê°€ê¸°</button>
  </div>

  <script>
    let timerStart = 0;
    let timerRunning = false;
    let interval = null;
    let pausedTime = 0;
    let lastPauseTime = 0;
    let currentUser = "";

    function login() {
      const username = document.getElementById("username").value.trim();
      if (username === "") {
        alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }
      currentUser = username;
      document.getElementById("userDisplay").innerText = currentUser;
      document.getElementById("login").style.display = "none";
      document.getElementById("app").style.display = "block";
    }

    function changeNickname() {
      const newName = prompt("ìƒˆ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”:", currentUser);
      if (newName && newName.trim()) {
        currentUser = newName.trim();
        document.getElementById("userDisplay").innerText = currentUser;
      }
    }

    function startTimer() {
      if (timerRunning) return;
      timerStart = Date.now();
      pausedTime = 0;
      interval = setInterval(updateTimer, 100);
      timerRunning = true;
    }

    function updateTimer() {
      const now = Date.now();
      const elapsed = ((now - timerStart - pausedTime) / 1000).toFixed(2);
      document.getElementById("timer").innerText = elapsed;
    }

    function togglePause() {
      if (!timerRunning) return;

      if (interval) {
        // ì¼ì‹œì •ì§€
        clearInterval(interval);
        interval = null;
        lastPauseTime = Date.now();
      } else {
        // ì¬ê°œ
        pausedTime += Date.now() - lastPauseTime;
        interval = setInterval(updateTimer, 100);
      }
    }

    function saveRecord() {
  if (!timerRunning && !interval) return;

  clearInterval(interval);
  interval = null;
  timerRunning = false;

  const finalTime = parseFloat(document.getElementById("timer").innerText);
  alert(`${finalTime.toFixed(2)}ì´ˆ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);

  const newRef = db.ref("records").push();
  newRef.set({
    name: currentUser,
    time: finalTime
  });

  document.getElementById("timer").innerText = "0.00";
}

    function showLeaderboard() {
      document.getElementById("app").style.display = "none";
      document.getElementById("leaderboard").style.display = "block";

      const table = document.getElementById("rankingTable");
      table.innerHTML = "<tr><th>ìˆœìœ„</th><th>ë‹‰ë„¤ì„</th><th>ê¸°ë¡ (ì´ˆ)</th></tr>";

      db.ref("records").once("value", (snapshot) => {
        const data = snapshot.val();
        const list = [];

        for (let key in data) {
          list.push(data[key]);
        }

        // ğŸ“Œ ê¸´ ì‹œê°„ì´ ë†’ì€ ìˆœìœ„ë¡œ!
        list.sort((a, b) => b.time - a.time);

        list.slice(0, 10).forEach((rec, index) => {
          const row = table.insertRow();
          row.insertCell(0).innerText = index + 1;
          row.insertCell(1).innerText = rec.name;
          row.insertCell(2).innerText = rec.time.toFixed(2);
        });
      });
    }

    function goBack() {
      document.getElementById("leaderboard").style.display = "none";
      document.getElementById("app").style.display = "block";
    }
  </script>
</body>
</html>
